(self.webpackChunkmaplestory_reverse=self.webpackChunkmaplestory_reverse||[]).push([[239],{239:(e,t,s)=>{"use strict";s.r(t);const o=Symbol("empty"),r=Symbol("slime"),n=Symbol("bean"),i=Symbol("hole"),a=[{dr:-1,dc:-1},{dr:-1,dc:0},{dr:-1,dc:1},{dr:0,dc:-1},{dr:0,dc:1},{dr:1,dc:-1},{dr:1,dc:0},{dr:1,dc:1}];async function l(e){return new Promise((t=>setTimeout(t,e)))}var c=s(832);const d=c.aN.shared.resources.assets.spritesheet,h={empty:[c.xE.EMPTY],slime:[d.textures.slime],bean:[d.textures.bean],hole:[d.textures.hole],guide:p(d.animations.guide,210),drop_slime:p(d.animations.drop_slime,120),drop_bean:p(d.animations.drop_bean,120),reverse_slime:p(d.animations.reverse_slime,120),reverse_bean:p(d.animations.reverse_bean,120)};function p(e,t){return e.map((e=>({texture:e,time:t})))}class m extends c.Kg{constructor(){super(h.empty),this.updateAnchor=!0,this.loop=!1,this.hitArea=new c.Ae(0,0,40,40)}set(e){switch(this.loop=!1,e){case o:this.textures=h.empty;break;case r:this.textures=h.slime;break;case n:this.textures=h.bean;break;case i:this.textures=h.hole}}guide(){this.textures=h.guide,this.loop=!0,this.play()}drop(e){this.textures=e===r?h.drop_slime:h.drop_bean,this.loop=!1,this.onComplete=function(){this.onComplete=null,this.set(e)},this.play()}reverse(e){this.textures=e===r?h.reverse_slime:h.reverse_bean,this.loop=!1,this.onComplete=function(){this.onComplete=null,this.set(e)},this.play()}}const u=[{description:"human",move:async({events:e})=>new Promise((t=>e.addEventListener("move",(e=>t(e.detail)),{once:!0})))},{description:"random",move:async({moves:e})=>e[Math.floor(Math.random()*e.length)]}],f=new class{constructor(){this.reset()}get(e,t){if(0<=e&&e<8&&0<=t&&t<8)return this.arr[8*e+t]}set(e,t,s){this.arr[8*e+t]=s}board(){const e=[...new Array(8)].map((()=>new Array(8)));for(let t=0;t<8;t++)for(let s=0;s<8;s++)e[t][s]=this.get(t,s);return e}moves(){const e=[];for(let t=0;t<8;t++)for(let s=0;s<8;s++)this.valid({row:t,col:s})&&e.push({row:t,col:s});return e}move(e){const t=[];if(void 0!==e){t.push(...this.flipped(e)),this.set(e.row,e.col,this.player);for(const e of t)for(const{row:t,col:s}of e)this.set(t,s,this.player)}return[this.player,this.opponent]=[this.opponent,this.player],t}valid(e){return void 0!==e&&this.get(e.row,e.col)===o&&this.flipped(e).length>0}flipped(e){const t=[];for(const{dr:s,dc:o}of a){const r=[];let n=e.row+s,i=e.col+o;for(;this.get(n,i)===this.opponent;)r.push({row:n,col:i}),n+=s,i+=o;if(r.length>0&&this.get(n,i)===this.player)for(let e=0;e<r.length;e++)e===t.length&&t.push([]),t[e].push(r[e])}return t}reset(){this.arr=new Array(64).fill(o),this.set(3,4,r),this.set(4,3,r),this.set(3,3,n),this.set(4,4,n),this.player=r,this.opponent=n}},v=new class{constructor(e){this.tiles=[...new Array(8)].map((()=>new Array(8))),this.events=new EventTarget,this.app=new c.Mx({width:334,height:335,view:e,transparent:!0}),this.app.stage.addChild(new c.jy(d.textures.background));const t=new c.W2;t.position.set(7,8);for(let e=0;e<8;e++)for(let s=0;s<8;s++){const o=new m(d);o.position.set(40*s,40*e),o.interactive=!0,o.on("pointertap",(()=>{const t=new CustomEvent("move",{detail:{row:e,col:s}});this.events.dispatchEvent(t)})),this.tiles[e][s]=o,t.addChild(o)}this.app.stage.addChild(t)}}(document.getElementById("board")),w=document.getElementById("start"),y=document.getElementById("slime"),g=document.getElementById("bean"),b=document.getElementById("info");let x=!1;function C(){x=w.disabled=y.disabled=g.disabled=!1,b.textContent="Click on empty tiles to toggle holes.",f.reset();for(let e=0;e<8;e++)for(let t=0;t<8;t++)v.tiles[e][t].set(f.get(e,t))}function k(e){switch(e){case r:return"Slime";case n:return"PinkBean"}}function E(e){for(const t of u){const s=document.createElement("option");s.text=t.description,e.add(s)}}E(y),E(g),C(),v.events.addEventListener("move",(function(e){const{row:t,col:s}=e.detail;if(x)f.valid({row:t,col:s})||e.stopImmediatePropagation();else switch(f.get(t,s)){case o:f.set(t,s,i),v.tiles[t][s].set(i);break;case i:f.set(t,s,o),v.tiles[t][s].set(o)}})),w.onclick=async function(){if(x)return;x=w.disabled=y.disabled=g.disabled=!0;const e=u[y.selectedIndex],t=u[g.selectedIndex];let s=Promise.resolve();for(;;){b.textContent=`${k(f.player)}'s turn.`;let n=f.moves();if(0===n.length){if(f.move(),n=f.moves(),!(n.length>0)){b.textContent="Game over!";break}b.textContent=`Turn skipped. ${k(f.player)}'s turn`}for(const{row:e,col:t}of n)v.tiles[e][t].guide();await s;const i=f.player===r?e:t,a=f.player,c=await i.move({moves:n,board:f.board(),events:v.events});if(!f.valid(c))throw new Error(`${k(f.player)} played an invalid move: ${JSON.stringify(c)}`);const d=f.move(c);for(const{row:e,col:t}of n)v.tiles[e][t].set(o);v.tiles[c.row][c.col].drop(a),s=async function(){for(const e of d){for(const{row:t,col:s}of e)v.tiles[t][s].reverse(a);await l(150)}await l(400)}()}await s,await l(1e3),C()}}}]);